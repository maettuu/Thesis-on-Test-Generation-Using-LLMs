it("should save PDF annotations on certain PDFs", async () => {
  const { PDFDocument } = await import("../../src/core/document.js");
  const { PDFWorker } = await import("../../src/display/api.js");
  const { createIdFactory } = await import("./test_utils.js");
  const { TEST_PDFS_PATH } = await import("./test_utils.js");

  const pdfWorker = new PDFWorker();
  const pdfDoc = await pdfWorker.loadPDF(TEST_PDFS_PATH + "issue_pdf.pdf");
  const idFactory = createIdFactory();

  const page = pdfDoc.getPage(1);
  const annotations = await page.getAnnotations();

  const newAnnotation = {
    subtype: "Widget",
    rect: [10, 10, 50, 50],
    ap: {
      normal: {
        s: "BG",
        g: "1 0 0 1 rg",
        c: "1 0 0 1 sc",
      },
    },
  };

  annotations.push(newAnnotation);
  await pdfDoc.saveAnnotations();

  const updatedPdfDoc = await pdfWorker.loadPDF(TEST_PDFS_PATH + "issue_pdf.pdf");
  const updatedPage = updatedPdfDoc.getPage(1);
  const updatedAnnotations = await updatedPage.getAnnotations();

  const expectedAnnotationsLength = annotations.length;
  const actualAnnotationsLength = updatedAnnotations.length;

  expect(actualAnnotationsLength).toBe(expectedAnnotationsLength);
});