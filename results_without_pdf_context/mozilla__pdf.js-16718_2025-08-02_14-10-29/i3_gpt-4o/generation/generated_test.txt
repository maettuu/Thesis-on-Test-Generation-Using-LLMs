it("should save PDF annotations correctly with linearization", async () => {
  const { XRef } = await import("../../src/core/xref.js");
  const { incrementalUpdate } = await import("../../src/core/writer.js");

  const xref = new XRef(null, null);
  const acroForm = new Dict();
  const acroFormRef = Ref.get(1, 0);
  const originalData = new Uint8Array([0, 1, 2, 3, 4, 5]);
  const xrefInfo = {
    newRef: Ref.get(2, 0),
    startXRef: 0,
    rootRef: null,
    encryptRef: null,
    infoRef: null,
    info: {},
    fileIds: null,
    filename: "test.pdf",
  };

  const newRefs = [];
  const hasXfa = false;
  const xfaDatasetsRef = null;
  const hasXfaDatasetsEntry = false;
  const needAppearances = false;
  const xfaData = null;

  const updatedData = await incrementalUpdate({
    originalData,
    xrefInfo,
    newRefs,
    xref,
    hasXfa,
    xfaDatasetsRef,
    hasXfaDatasetsEntry,
    needAppearances,
    acroFormRef,
    acroForm,
    xfaData,
  });

  expect(updatedData).not.toEqual(originalData);
});