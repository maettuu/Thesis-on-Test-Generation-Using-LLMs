it("should save annotations in linearized PDFs", async () => {
  const { PDFDocument, Annotation, Page } = await import("../../src/core/document.js");
  const { pdfManager } = await import("../../src/core/worker.js");

  // Create a new PDF document
  const pdfDoc = new PDFDocument();
  const page = pdfDoc.addPage();

  // Create and add an annotation
  const rect = new PDFRect(100, 100, 200, 200);
  const annotation = new Annotation(rect, "Test Annotation");
  page.addAnnotation(annotation);

  // Save the PDF with linearization
  const savedPdf = await pdfDoc.save();

  // Load the saved PDF back
  const loadedPdf = await PDFDocument.load(savedPdf);
  const loadedPage = await loadedPdf.getPage(1);

  // Verify the annotation exists in the loaded PDF
  expect(loadedPage.getAnnotations().length).toBe(1);
});