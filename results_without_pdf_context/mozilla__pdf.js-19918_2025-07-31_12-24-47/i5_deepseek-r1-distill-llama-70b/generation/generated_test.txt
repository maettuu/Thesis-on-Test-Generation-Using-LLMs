it("should decode CMYK JPEG images using ImageDecoder", async () => {
  const { JpegImage } = await import("../../src/core/jpg.js");

  // Create a sample CMYK JPEG image data
  const cmykImageData = new Uint8Array([
    0xFF, 0xD8, 0xFF, 0xE0, 0x00, 0x10, 0x4A, 0x46, 0x49, 0x46, 0x00, 0x01,
    0x00, 0x00, 0x00, 0x0C, 0x03, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xFF, 0xC0, 0x00, 0x11, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0xC4, 0x00, 0x14, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xDA, 0x00, 0x0C, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xD9
  ]);

  // Test before patch
  const beforeResult = await JpegImage.canUseImageDecoder(cmykImageData);
  const beforeComponents = beforeResult.numComponents || 0;

  // Test after patch
  const afterResult = await JpegImage.canUseImageDecoder(cmykImageData);
  const afterComponents = afterResult.numComponents || 0;

  // Verify that before patch, CMYK was not supported and after patch it is
  expect(beforeComponents).toBe(3);
  expect(afterComponents).toBe(4);
});