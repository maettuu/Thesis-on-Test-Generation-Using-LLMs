it("should fix free highlighting lag behind cursor", async () => {
  const { PDFDocumentProxy } = await import("../../src/display/api.js");
  const { Outliner } = await import("../../src/display/editor/outliner.js");
  const { XRefMock } = await import("./test_utils.js");

  // Create a mock PDF document with one page
  const xRef = new XRefMock();
  const pdf = await PDFDocumentProxy.create({
    xref: xRef,
    filename: "test.pdf",
    length: 1,
  });
  const page = (await pdf.getPages())[0];

  // Get the outliner instance
  const annotationLayer = page.annotationLayer;
  const outliner = new Outliner(annotationLayer);

  // Simulate adding points to the outliner
  const points = [
    { x: 100, y: 100 },
    { x: 150, y: 150 },
    { x: 200, y: 200 },
  ];

  points.forEach((point) => outliner.add(point));

  // Check if the last coordinates are correctly updated
  const [lastTopX, lastTopY, lastBottomX, lastBottomY] = outliner.#getLastCoords();
  expect(lastTopX).toBeCloseTo(points[points.length - 1].x / page.viewport.width);
  expect(lastTopY).toBeCloseTo(points[points.length - 1].y / page.viewport.height);
  expect(lastBottomX).toBeCloseTo(points[points.length - 1].x / page.viewport.width);
  expect(lastBottomY).toBeCloseTo(points[points.length - 1].y / page.viewport.height);
});