it("should correctly set noHTML flag for annotations with hasOwnCanvas", async () => {
  const { Annotation, AnnotationFactory } = await import("../../src/core/annotation.js");
  const { XRef } = await import("../../src/core/primitives.js");

  // Setup fake PDF document with one page
  const xref = new XRef();
  const pdfDocument = {
    getCatalog: () => ({
      getPages: () => ({
        getKids: () => [{}],
        getLength: () => 1,
      }),
    }),
  };

  // Test each annotation type that should have noHTML: false
  const annotations = [
    { type: AnnotationFactory.Type.TEXT, hasOwnCanvas: true },
    { type: AnnotationFactory.Type.POPUP, hasOwnCanvas: false },
    { type: AnnotationFactory.Type.FREETEXT, hasOwnCanvas: true },
    { type: AnnotationFactory.Type.LINE, hasOwnCanvas: true },
    { type: AnnotationFactory.Type.SQUARE, hasOwnCanvas: true },
    { type: AnnotationFactory.Type.POLYLINE, hasOwnCanvas: true },
    { type: AnnotationFactory.Type.STAMP, hasOwnCanvas: true },
    { type: AnnotationFactory.Type.FILEATTACHMENT, hasOwnCanvas: true },
  ];

  for (const { type, hasOwnCanvas } of annotations) {
    const annotation = new AnnotationFactory({
      type,
      xref,
      pdfDocument,
      dict: {},
      params: { hasOwnCanvas },
    }).create();

    expect(annotation.noHTML).toBe(false);
  }
});