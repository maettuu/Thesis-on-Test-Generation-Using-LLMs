it("should display images with masks in PDF files", async () => {
  const { PDFDocument } = await import("../../src/core/document.js");
  const { PDFPageProxy } = await import("../../src/display/api.js");
  const { OperatorList } = await import("../../src/core/operator_list.js");

  // Create a simple PDF with an image that has a mask
  const pdf = new PDFDocument();
  const page = pdf.addPage();
  const xref = pdf.xref;
  const imageRef = pdf.ref();
  const image = pdf.image();
  image.hasMask = true;

  // Draw the image on the page
  page.drawImage(image, 100, 100, 200, 200);

  // Save the PDF
  const pdfBuffer = await pdf.save();

  // Load the PDF back
  const pdfDoc = await PDFDocument.load(pdfBuffer);
  const pageProxy = (await pdfDoc.getPage(1)) as PDFPageProxy;

  // Render the page and check if the image is present
  const operatorList = await pageProxy.getOperatorList();
  const drawImageOps = operatorList.ops.some(op => op.fn === OPS.drawImage);

  expect(drawImageOps).toBe(true);
});