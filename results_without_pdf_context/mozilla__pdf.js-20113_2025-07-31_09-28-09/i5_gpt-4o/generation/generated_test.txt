it("should fix the object generation number in the xref table", async () => {
  const { XRef } = await import("../../src/core/xref.js");
  const { XRefMock } = await import("./test_utils.js");

  const xref = new XRefMock([
    { num: 1, offset: 100, gen: 0 },
    { num: 2, offset: 200, gen: 1 },
  ]);

  const tableOffset = 100;
  const nums = [1, 2];
  const offsets = [100, 200];

  const xrefInstance = new XRef();
  xrefInstance.getEntry = (num) => xref.getEntry(num);

  for (let i = 0; i < nums.length; i++) {
    const num = nums[i];
    const entry = xrefInstance.getEntry(num);
    if (entry?.offset === tableOffset && entry.gen !== i) {
      entry.gen = i;
    }
  }

  const expected = [0, 1];
  const actual = nums.map(num => xrefInstance.getEntry(num).gen);
  expect(actual).toEqual(expected);
});