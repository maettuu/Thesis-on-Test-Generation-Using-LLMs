it("should handle circular references in Form XObjects without endless loop", async () => {
  const { getDocument } = await import("../../src/display/api.js");
  const { PDFNodeStream } = await import("../../src/display/node_stream.js");
  const fs = await import("fs");
  const path = await import("path");

  const pdfPath = path.resolve(__dirname, "evil_xobjects.pdf");
  const data = new Uint8Array(fs.readFileSync(pdfPath));
  const loadingTask = getDocument({ data, disableAutoFetch: true, isEvalSupported: false, stream: new PDFNodeStream() });

  const pdfDocument = await loadingTask.promise;
  const page = await pdfDocument.getPage(1);
  const operatorList = await page.getOperatorList();

  const expectedOpsCount = 3; // Based on Ghostscript's behavior
  const actualOpsCount = operatorList.argsArray.length;

  expect(actualOpsCount).toBe(expectedOpsCount);
});