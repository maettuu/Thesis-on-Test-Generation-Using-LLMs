it("should display FreeText annotation popup correctly", async () => {
  const { PDFDocument, PDFPageProxy } = await import("../../src/display/api.js");
  const { buildGetDocumentParams } = await import("./test_utils.js");
  const { TEST_PDFS_PATH } = await import("../../src/core/display/annotation_layer.js");

  const pdfPath = `${TEST_PDFS_PATH}/annotation/free_text.pdf`;
  const params = buildGetDocumentParams(pdfPath, {});
  const pdf = await PDFDocument.load(params);
  const page = await pdf.getPage(1);

  const annotations = await page.getAnnotations();
  const freeTextAnnotation = annotations.find(
    (annotation) => annotation.annotationType === "FreeText"
  );

  const { AnnotationLayer } = await import("../../src/display/annotation_layer.js");
  const layer = new AnnotationLayer({
    div: document.createElement("div"),
    page,
    viewport: page.viewport,
    l10n: new (await import("../../web/l10n_utils.js")).NullL10n(),
    linkService: {},
    downloadManager: {},
  });

  await layer.render({
    annotations: [freeTextAnnotation],
    viewport: page.viewport,
    renderForms: true,
  });

  const popupTrigger = layer.div.querySelector(".freeTextAnnotation");
  const popup = layer.div.querySelector(".popup");

  expect(popupTrigger).toBeTruthy();
  expect(popup).toBeTruthy();
});