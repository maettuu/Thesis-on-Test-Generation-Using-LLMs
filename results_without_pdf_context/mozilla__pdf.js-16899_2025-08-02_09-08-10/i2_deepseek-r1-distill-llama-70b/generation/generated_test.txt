it("should render FreeText annotation with missing popup data", async () => {
  const { PDFDocument } = await import("../../src/core/document.js");
  const { AnnotationLayer } = await import("../../src/display/annotation_layer.js");
  const { Annotation } = await import("../../src/core/annotation.js");

  // Create a mock PDF document
  const pdfDocument = new PDFDocument({
    url: "example.pdf",
    fingerprint: "example-fingerprint",
  });

  // Create a mock annotation with missing popup data
  const annotation = new Annotation({
    type: "FreeText",
    data: {
      popupRef: null,
      titleObj: { str: null },
      contentsObj: { str: null },
      richText: { str: null },
    },
  });

  // Create the annotation layer
  const layer = new AnnotationLayer({
    pdfPage: pdfDocument.getPage(1),
    annotationStorage: new (await import("../../src/display/annotation_storage.js")).AnnotationStorage(),
  });

  // Add the annotation to the layer
  layer.addAnnotation(annotation);

  // Render the layer
  const container = layer.render();

  // The container should exist and have content
  expect(container.length).toBeGreaterThan(0);
});