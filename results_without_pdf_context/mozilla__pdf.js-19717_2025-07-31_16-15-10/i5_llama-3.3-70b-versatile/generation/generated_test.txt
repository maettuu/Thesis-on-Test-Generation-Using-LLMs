it("should preserve fillAlpha and strokeAlpha when entering soft mask mode", async () => {
  const { CanvasGraphics } = await import("../../src/display/canvas.js");
  const fakeInitialCtx = {
    globalAlpha: 0.5,
    canvas: { width: 100, height: 100 },
    setTransform() {},
    getTransform() {
      return new DOMMatrix();
    },
  };
  const fakeScratchCtx = {
    globalAlpha: 0.5,
    canvas: { width: 100, height: 100 },
    setTransform() {},
    getTransform() {
      return new DOMMatrix();
    },
  };
  const canvasFactory = {
    getCanvas: (id, width, height) => ({ context: fakeScratchCtx }),
  };
  const filterFactory = { addFilter: () => "" };
  const commonObjs = {};
  const objs = {};
  const options = { optionalContentConfig: null };
  const annotationCanvasMap = {};
  const pageColors = {};
  const cg = new CanvasGraphics(
    fakeInitialCtx,
    commonObjs,
    objs,
    canvasFactory,
    filterFactory,
    options,
    annotationCanvasMap,
    pageColors
  );
  cg.current.fillAlpha = 0.3;
  cg.current.strokeAlpha = 0.4;
  cg.beginSMaskMode();
  if (cg.current.fillAlpha !== 0.3) {
    throw new Error("fillAlpha was overridden after entering soft mask mode");
  }
  if (cg.current.strokeAlpha !== 0.4) {
    throw new Error("strokeAlpha was overridden after entering soft mask mode");
  }
});