it("should correctly apply the backdrop fill when mask extension occurs", async () => {
  const { Util } = await import("../../src/shared/util.js");
  const { CanvasGraphics } = await import("../../src/display/canvas.js");
  const { DefaultCanvasFactory } = await import("../../src/display/api.js");
  const factory = new DefaultCanvasFactory();
  const maskObj = factory.create(70, 50);
  const layerObj = factory.create(50, 50);
  const maskCtx = maskObj.context;
  const layerCtx = layerObj.context;
  maskCtx.fillStyle = "#ffffff";
  maskCtx.fillRect(0, 0, 70, 50);
  const dummyFilterFactory = { addAlphaFilter: () => "" , addLuminosityFilter: () => "" };
  const cg = new CanvasGraphics(layerCtx, {}, {}, factory, dummyFilterFactory, {}, null);
  const backdrop = [0, 0, 0];
  // Setting layerOffsetX=0 and maskOffsetX=10 forces maskX = -10 (mask extension branch)
  cg.genericComposeSMask(maskCtx, layerCtx, 50, 50, "Alpha", backdrop, null, 0, 0, 10, 0);
  const { data } = layerCtx.getImageData(25, 25, 1, 1);
  if (!(data[0] === 0 && data[1] === 0 && data[2] === 0 && data[3] === 255)) {
    throw new Error("Backdrop fill not correctly applied");
  }
});