it("should not cache null XRef entries so that a later valid entry is fetched", async () => {
  const { XRef } = await import("../../src/core/xref.js");
  const dummyStream = {};
  const dummyPdfManager = {};
  const dummyRef = { num: 1, toString: () => "1 0 R" };
  let callCount = 0;
  const fakeXRef = new XRef(dummyStream, dummyPdfManager);
  fakeXRef.getEntry = function (num) {
    callCount++;
    return callCount === 1 ? null : { uncompressed: true };
  };
  // First fetch returns null and, in pre-patch, caches the null.
  const firstFetch = fakeXRef.fetch(dummyRef);
  // Second fetch:
  const secondFetch = fakeXRef.fetch(dummyRef);
  if (secondFetch === null) {
    throw new Error("Bug persists: cached null entry returned on subsequent fetch.");
  }
});