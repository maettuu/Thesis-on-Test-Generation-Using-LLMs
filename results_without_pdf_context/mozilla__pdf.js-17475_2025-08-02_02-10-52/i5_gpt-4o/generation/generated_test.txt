it("should correctly serialize and deserialize highlight annotations with visible highlights on cropped PDFs", async () => {
  const { AnnotationEditorType } = await import("../../src/shared/util.js");
  const { HighlightEditor } = await import("../../src/display/editor/highlight.js");
  const { PDFDocumentProxy } = await import("../../src/display/api.js");

  const pageDimensions = [600, 800];
  const rect = [100, 100, 500, 700];
  const color = [255, 0, 0];
  const opacity = 0.5;
  const quadPoints = [100, 100, 200, 100, 200, 200, 100, 200];

  const data = {
    rect,
    color,
    opacity,
    quadPoints,
    annotationType: AnnotationEditorType.HIGHLIGHT,
  };

  const parent = null;
  const uiManager = null;

  const editor = HighlightEditor.deserialize(data, parent, uiManager);
  editor.pageDimensions = pageDimensions;

  const serialized = editor.serialize();

  const expectedQuadPoints = [200, 600, 300, 600, 300, 700, 200, 700];
  const expectedRect = rect;

  expect(serialized.quadPoints).toEqual(expectedQuadPoints);
  expect(serialized.rect).toEqual(expectedRect);
});