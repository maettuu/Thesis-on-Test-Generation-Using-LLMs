it("should support pasting an image from clipboard", async () => {
  const { AnnotationEditorUIManager } = await import("../../src/display/editor/tools.js");
  const { StampEditor } = await import("../../src/display/editor/stamp.js");

  const uiManager = new AnnotationEditorUIManager();
  const currentLayer = {
    add: jest.fn(),
    getNextId: () => "test-id",
    div: {
      getBoundingClientRect: () => ({
        x: 0,
        y: 0,
        width: 100,
        height: 100,
      }),
    },
  };
  uiManager.currentLayer = currentLayer;

  const clipboardData = {
    items: [
      new DataTransferItem(
        new File(["test"], "test.png", { type: "image/png" }),
        "image/png"
      ),
    ],
    getData: () => "test-data",
  };

  const event = {
    preventDefault: jest.fn(),
    clipboardData,
  };

  const mockAddEventListener = jest.fn();
  const mockAdd = jest.fn();

  currentLayer.add = mockAdd;
  currentLayer.addEventListener = mockAddEventListener;

  await uiManager.paste(event);

  // Wait for async operations
  await new Promise(resolve => setTimeout(resolve, 100));

  expect(mockAddEventListener).toHaveBeenCalled();
  expect(uiManager.currentEditor).toBeInstanceOf(StampEditor);
  expect(uiManager.currentEditor.#bitmapFile).toBeTruthy();
});