it("should use correct font family on Windows Firefox", async () => {
  const { FeatureTest } = await import("../../src/shared/util.js");
  const { TextLayer } = await import("../../src/display/text_layer.js");

  // Mock platform detection
  const originalPlatform = FeatureTest.platform;
  FeatureTest.platform = () => ({
    isWindows: true,
    isFirefox: true,
  });

  const container = document.createElement("div");
  const textLayer = new TextLayer({
    textContentSource: new ReadableStream({
      start(controller) {
        controller.enqueue("Test");
        controller.close();
      },
    }),
    container,
    viewport: {
      scale: 1,
      rotation: 0,
      rawDims: { pageWidth: 100, pageHeight: 100, pageX: 0, pageY: 0 },
    },
  });

  const style = {
    fontFamily: 'sans-serif',
    fontSubstitution: 'sans-serif',
    vertical: false,
  };

  const fontFamily = TextLayer.fontFamilyMap.get(style.fontFamily) || style.fontFamily;
  expect(fontFamily).toContain("Calibri");
});