it("should apply correct font family mapping on Windows with Firefox", async () => {
  const { FeatureTest } = await import("../../src/shared/util.js");
  const { TextLayer } = await import("../../src/display/text_layer.js");

  // Mock platform and userAgent to simulate Windows with Firefox
  Object.defineProperty(FeatureTest, "platform", {
    get: () => ({ isWindows: true, isFirefox: true }),
  });

  const textLayer = new TextLayer({
    textContentSource: new ReadableStream({
      start(controller) {
        controller.enqueue({
          items: [{ str: "Test", fontName: "sans-serif" }],
          styles: { "sans-serif": { fontFamily: "sans-serif" } },
        });
        controller.close();
      },
    }),
    container: document.createElement("div"),
    viewport: { scale: 1, rotation: 0, rawDims: { pageWidth: 100, pageHeight: 100, pageX: 0, pageY: 0 } },
  });

  await textLayer.render();

  const expectedFontFamily = "Calibri, sans-serif";
  const actualFontFamily = textLayer.textDivs[0].style.fontFamily;
  expect(actualFontFamily).toBe(expectedFontFamily);
});