it("should correctly update annotation flags when saving with noViewnoPrint set", async () => {
  const { WidgetAnnotation } = await import("../../src/core/annotation.js");
  const { Dict, Name } = await import("../../src/core/primitives.js");
  const { XRefMock } = await import("./test_utils.js");
  const xref = new XRefMock();
  const dict = new Dict(xref);
  dict.set("F", 0);
  dict.set("FT", Name.get("Btn"));
  const annotationGlobals = { acroForm: new Dict(xref) };
  const widget = new WidgetAnnotation({
    dict,
    xref,
    annotationGlobals,
    pageRef: null,
    pageIndex: 0,
    id: "testAnnot",
    needAppearances: true,
    collectFields: true,
  });
  const storageEntry = { noView: true, noPrint: false, value: widget.data.fieldValue, rotation: undefined };
  const annotationStorage = new Map();
  annotationStorage.set(widget.data.id, storageEntry);
  const evaluator = { xref };
  const task = { name: "testTask" };
  const changes = await widget.save(evaluator, task, annotationStorage);
  const savedData = changes && changes[0] && changes[0].data;
  if (!savedData) {
    throw new Error("No saved data returned");
  }
  if (!savedData.includes("/F")) {
    throw new Error("Annotation flags were not properly updated in the saved data");
  }
});
