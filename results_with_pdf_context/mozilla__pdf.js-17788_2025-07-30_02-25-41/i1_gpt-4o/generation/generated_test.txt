it("should read highlighted text during editing inside a PDF", async () => {
  const { AnnotationEditorUIManager } = await import("../../src/display/editor/tools.js");
  const { HighlightEditor } = await import("../../src/display/editor/highlight.js");
  const { EventBus } = await import("../../web/event_utils.js");

  const eventBus = new EventBus();
  const container = document.createElement("div");
  const viewer = document.createElement("div");
  container.appendChild(viewer);

  const uiManager = new AnnotationEditorUIManager(container, viewer, null, eventBus, null, null, null, null);
  uiManager.#mode = AnnotationEditorType.HIGHLIGHT;

  const textLayer = document.createElement("div");
  textLayer.className = "textLayer";
  viewer.appendChild(textLayer);

  const textNode = document.createTextNode("Highlighted text");
  textLayer.appendChild(textNode);

  const range = document.createRange();
  range.selectNodeContents(textNode);
  const selection = window.getSelection();
  selection.removeAllRanges();
  selection.addRange(range);

  uiManager.highlightSelection();

  const highlightEditor = new HighlightEditor({
    anchorNode: textNode,
    anchorOffset: 0,
    focusNode: textNode,
    focusOffset: textNode.length,
    text: "Highlighted text",
  });

  const div = highlightEditor.render();
  const mark = div.querySelector("mark.visuallyHidden");
  const actualText = mark ? mark.textContent : null;

  expect(actualText).toBe("Highlighted text");
});