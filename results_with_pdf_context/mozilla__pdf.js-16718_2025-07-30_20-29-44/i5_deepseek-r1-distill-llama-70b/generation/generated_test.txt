it("should save annotations on PDFs with linearization", async () => {
  const { getDocument } = await import("../../src/display/api.js");
  const { buildGetDocumentParams } = await import("./test_utils.js");

  // Load the PDF with the issue
  const loadingTask = getDocument(buildGetDocumentParams('bug1844572.pdf'));
  const pdfDocument = await loadingTask.promise;

  // Create a new annotation
  const annotation = {
    type: "annotation",
    subtype: "widget",
    page: 0,
    rect: [100, 100, 200, 200],
    flags: ["hidden"],
    fieldFlags: 1,
    name: "testWidget",
    value: "Test Value"
  };

  // Add and save the annotation
  const saveTask = pdfDocument.addAnnotation(annotation).then(() => pdfDocument.save());
  await expect(saveTask).resolves.not.toThrow();

  // Reload the PDF to verify the annotation was saved
  const reloadTask = getDocument(buildGetDocumentParams('bug1844572.pdf'));
  const reloadedDocument = await reloadTask.promise;
  const annotations = await reloadedDocument.getAnnotations({ page: 0 });

  // Verify the annotation exists after reload
  expect(annotations).toHaveLength(1);
});