it("should save PDF annotations correctly", async () => {
  const { getDocument } = await import("../../src/display/api.js");
  const { buildGetDocumentParams } = await import("./test_utils.js");
  const loadingTask = getDocument(buildGetDocumentParams("bug1844572.pdf"));
  const pdfDocument = await loadingTask.promise;
  const page = await pdfDocument.getPage(1);
  const annotations = await page.getAnnotations();
  const annotationStorage = new Map();
  annotations.forEach(annotation => {
    annotationStorage.set(annotation.id, { value: "Test" });
  });
  const data = await pdfDocument.saveDocument({
    annotationStorage,
    filename: "test.pdf",
  });
  const savedDocument = await getDocument({ data }).promise;
  const savedPage = await savedDocument.getPage(1);
  const savedAnnotations = await savedPage.getAnnotations();
  const expected = annotations.map(a => ({ ...a, value: "Test" }));
  expect(savedAnnotations).toEqual(expected);
});