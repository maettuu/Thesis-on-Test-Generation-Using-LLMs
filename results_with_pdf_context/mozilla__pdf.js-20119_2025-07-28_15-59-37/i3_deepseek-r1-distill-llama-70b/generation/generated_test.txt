it("should add comment when using context menu on text selection", async () => {
  const { AnnotationEditorUIManager } = await import("../../src/display/editor/tools.js");
  const { TextLayer } = await import("../../src/display/text_layer.js");
  const { createIdFactory } = await import("../../src/core/core_utils.js");

  const idFactory = createIdFactory();
  const textLayer = {
    closest: () => ({
      getBoundingClientRect: () => ({ x: 0, y: 0, width: 100, height: 100 })
    }),
    getAttribute: () => "ltr"
  };

  const mockCommentManager = {
    commentSelection: jest.fn(),
    hasCommentManager: () => true
  };

  const uiManager = new AnnotationEditorUIManager(
    document.createElement("div"),
    document.createElement("div"),
    document.createElement("div"),
    null,
    mockCommentManager,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null
  );

  const event = new Event("contextmenu");
  const selection = {
    toString: () => "test selection",
    getRangeAt: () => ({
      getClientRects: () => [{ x: 0, y: 0, width: 100, height: 100 }]
    })
  };

  document.getSelection = () => selection;

  uiManager.onEditingAction({ name: "commentSelection" });

  expect(mockCommentManager.commentSelection).toHaveBeenCalled();
});