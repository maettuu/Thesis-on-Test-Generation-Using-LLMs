it("should correctly handle free text highlight after rotation", async () => {
  const { DrawLayer } = await import("../../src/display/draw_layer.js");
  const { HighlightEditor } = await import("../../src/display/editor/highlight.js");
  const { Util } = await import("../../shared/util.js");

  const viewport = {
    rawDims: { pageWidth: 100, pageHeight: 100 },
    rotation: 90,
  };

  const highlight = new HighlightEditor({
    color: "red",
    opacity: 1,
    pageIndex: 0,
    uiManager: {
      getMode: () => "highlight",
    },
  });

  const drawLayer = new DrawLayer({ pageIndex: 0 });
  drawLayer.setPageBox(viewport.rawDims);

  const outline = {
    box: {
      x: 0.1,
      y: 0.1,
      width: 0.2,
      height: 0.2,
    },
    toSVGPath: () => "M 0 0 L 1 1",
    free: () => true,
  };

  const id = drawLayer.highlight(outline, "red", 1, true);
  drawLayer.rotate(id, 90);

  const expectedBox = {
    x: 0.2,
    y: 0.2,
    width: 0.1,
    height: 0.2,
  };

  const actualBox = drawLayer.#mapping.get(id).getBoundingClientRect();

  expect(actualBox).toEqual(expectedBox);
});