it("should compute OS2 table typoAscender correctly using maxfontMatrix rather than first element", async () => {
  const { createOS2Table } = await import("../../src/core/fonts.js");
  const properties = {
    bbox: [0, -500, 500, 3000],
    ascent: 3000,
    descent: -500,
    fontMatrix: [2, 0, 0, 3, 0, 0],
    fixedPitch: false,
    italicAngle: 0,
    xHeight: 10,
    capHeight: 10,
  };
  // Pass no charstrings so that firstCharIndex becomes 0 and lastCharIndex becomes 255.
  const os2Table = createOS2Table(properties, null, {});
  // The typoAscender field is written as a 2-byte big-endian string at offset 68-70.
  const typoAscenderBytes = os2Table.slice(68, 70);
  // With the patched code, unitsPerEm = 1/Math.max(2,0,0,3)=1/3; scale = (1/3)/1000 = 0.0003333;
  // typoAscender = Math.round(3000 * 0.0003333) = 1, i.e. "\x00\x01".
  if (typoAscenderBytes !== "\x00\x01") {
    throw new Error(
      `Expected typoAscender bytes to be "\\x00\\x01" but got ${JSON.stringify(
        typoAscenderBytes
      )}`
    );
  }
});
