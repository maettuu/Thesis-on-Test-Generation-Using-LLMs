it("should use ImageDecoder for JPEG images", async () => {
  const { JpegStream } = await import("../../src/core/jpeg_stream.js");
  const { JpegImage } = await import("../../src/core/jpg.js");

  // Create a minimal JPEG buffer (1x1 red pixel)
  const jpegData = new Uint8Array([
    0xFF, 0xD8, 0xFF, 0xE0, 0x00, 0x10, 0x4A, 0x46, 0x49, 0x46, 0x00, 0x01,
    0x00, 0x00, 0x00, 0xFF, 0xDB, 0x00, 0xC0, 0x00, 0x04, 0x05, 0x04,
    0x04, 0x05, 0x00, 0xDB, 0x00, 0xC0, 0x00, 0x04, 0x05, 0x04, 0x04,
    0x05, 0x00, 0xDB, 0x00, 0xC0, 0x00, 0x04, 0x05, 0x04, 0x04, 0x05,
    0x00, 0xFF, 0xDA, 0x01, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xD9
  ]);

  const stream = new JpegStream({
    stream: { getBytes: () => jpegData },
    params: { colorTransform: -1 }
  });

  const image = await stream.getTransferableImage();
  expect(image).not.toBeNull();
});