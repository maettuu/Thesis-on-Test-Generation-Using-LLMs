it("should set the alpha channel to 255 for CMYK images when using DeviceCmykCS", async () => {
  const { JpegImage } = await import("../../src/core/jpg.js");
  const { ColorSpaceUtils } = await import("../../src/core/colorspace_utils.js");
  const { DeviceCmykCS } = await import("../../src/core/colorspace.js");
  // Override the ColorSpaceUtils.cmyk with a DeviceCmykCS instance that produces alpha = 0.
  ColorSpaceUtils.cmyk = new DeviceCmykCS();
  ColorSpaceUtils.cmyk.getRgbBuffer = (src, srcOffset, numPixels, dest, destOffset, bits, scale) => {
    for (let i = 0; i < numPixels; i++) {
      const idx = destOffset + i * 4;
      dest[idx] = 10;
      dest[idx + 1] = 20;
      dest[idx + 2] = 30;
      dest[idx + 3] = 0;
    }
  };
  const jpegImage = new JpegImage();
  const data = new Uint8ClampedArray(4); // one pixel RGBA: [r, g, b, alpha]
  jpegImage._convertCmykToRgba(data);
  if (data[3] !== 255) {
    throw new Error("Expected alpha channel value to be 255, but got " + data[3]);
  }
});
