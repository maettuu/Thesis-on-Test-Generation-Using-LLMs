## GitHub Pull Request 18910
[[pull request]](https://github.com/mozilla/pdf.js/pull/18910)
[[linked issue]](https://bugzilla.mozilla.org/show_bug.cgi?id=1901223)

The test below is automatically generated and could serve as a regression test for this PR because it:
- passes in the post-PR codebase, and
- fails in the pre-PR codebase.

```javascript
import { BaseStream }   from "../../src/core/base_stream.js";
import { JpegStream }   from "../../src/core/jpeg_stream.js";

describe("JpegStream", function () {
  it("should use ImageDecoder for JPEG images when supported", async function () {
  class MockStream extends BaseStream {
    constructor() {
      super();
      this.data = new Uint8Array([0xff, 0xd8, 0xff, 0xe0, 0x00, 0x10, 0x4a, 0x46, 0x49, 0x46, 0x00, 0x01, 0x01, 0x01, 0x00, 0x48, 0x00, 0x48, 0x00, 0x00, 0xff, 0xdb, 0x00, 0x43, 0x00, 0x08, 0x06, 0x06, 0x07, 0x06, 0x05, 0x08, 0x07, 0x07, 0x07, 0x09, 0x09, 0x08, 0x0a, 0x0c, 0x14, 0x0d, 0x0c, 0x0b, 0x0b, 0x0c, 0x19, 0x12, 0x13, 0x0f, 0x14, 0x1d, 0x1a, 0x1f, 0x1e, 0x1d, 0x1a, 0x1c, 0x1c, 0x20, 0x24, 0x2e, 0x27, 0x20, 0x22, 0x2c, 0x23, 0x1c, 0x1c, 0x28, 0x37, 0x29, 0x2c, 0x30, 0x31, 0x34, 0x34, 0x34, 0x1f, 0x27, 0x39, 0x3d, 0x38, 0x32, 0x3c, 0x2e, 0x33, 0x34, 0x32, 0xff, 0xc0, 0x00, 0x11, 0x08, 0x00, 0x10, 0x00, 0x10, 0x03, 0x01, 0x22, 0x00, 0x02, 0x11, 0x01, 0x03, 0x11, 0x01, 0xff, 0xc4, 0x00, 0x1f, 0x00, 0x00, 0x01, 0x05, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0xff, 0xda, 0x00, 0x0c, 0x03, 0x01, 0x00, 0x02, 0x11, 0x03, 0x11, 0x00, 0x3f, 0x00, 0xd2, 0xcf, 0x20, 0xff, 0xd9]);
    }
    getBytes() { return this.data; }
  }

  const mockStream = new MockStream();
  const jpegStream = new JpegStream(mockStream, mockStream.data.length, null);

  const canUseImageDecoder = await JpegStream.canUseImageDecoder;
  const transferableImage = await jpegStream.getTransferableImage();

  if (canUseImageDecoder) {
    expect(transferableImage).not.toBeNull();
  } else {
    expect(transferableImage).toBeNull();
  }
});
```

Our automated pipeline created a new test file `test/unit/jpg_spec.js` because no fitting file was found.
The test failed on the pre-PR codebase with the following message.

```text
Failures:
1) JpegStream should use ImageDecoder for JPEG images when supported
  Message:
    TypeError: jpegStream.getTransferableImage is not a function
  Stack:
        at UserContext.<anonymous> (file:///app/testbed/build/lib-legacy/test/unit/jpg_spec.js:503:48)

Ran 1 of 991 specs
1 spec, 1 failure
Finished in 0.059 seconds
```

This is part of our research at the [ZEST](https://www.ifi.uzh.ch/en/zest.html) group of University of Zurich in collaboration with [Mozilla](https://www.mozilla.org/). \
Looking forward to see what you think of the test. If you find it useful, we can open a PR. Thanks for your time.

<details> <summary>Click to see the test patch.</summary>

```diff
diff --git a/jpg_spec.js b/jpg_spec.js
new file mode 100644
index 0000000..343c9d4
--- /dev/null
+++ b/jpg_spec.js
@@ -0,0 +1,25 @@
+import { BaseStream }   from "../../src/core/base_stream.js";
+import { JpegStream }   from "../../src/core/jpeg_stream.js";
+
+describe("JpegStream", function () {
+  it("should use ImageDecoder for JPEG images when supported", async function () {
+  class MockStream extends BaseStream {
+    constructor() {
+      super();
+      this.data = new Uint8Array([0xff, 0xd8, 0xff, 0xe0, 0x00, 0x10, 0x4a, 0x46, 0x49, 0x46, 0x00, 0x01, 0x01, 0x01, 0x00, 0x48, 0x00, 0x48, 0x00, 0x00, 0xff, 0xdb, 0x00, 0x43, 0x00, 0x08, 0x06, 0x06, 0x07, 0x06, 0x05, 0x08, 0x07, 0x07, 0x07, 0x09, 0x09, 0x08, 0x0a, 0x0c, 0x14, 0x0d, 0x0c, 0x0b, 0x0b, 0x0c, 0x19, 0x12, 0x13, 0x0f, 0x14, 0x1d, 0x1a, 0x1f, 0x1e, 0x1d, 0x1a, 0x1c, 0x1c, 0x20, 0x24, 0x2e, 0x27, 0x20, 0x22, 0x2c, 0x23, 0x1c, 0x1c, 0x28, 0x37, 0x29, 0x2c, 0x30, 0x31, 0x34, 0x34, 0x34, 0x1f, 0x27, 0x39, 0x3d, 0x38, 0x32, 0x3c, 0x2e, 0x33, 0x34, 0x32, 0xff, 0xc0, 0x00, 0x11, 0x08, 0x00, 0x10, 0x00, 0x10, 0x03, 0x01, 0x22, 0x00, 0x02, 0x11, 0x01, 0x03, 0x11, 0x01, 0xff, 0xc4, 0x00, 0x1f, 0x00, 0x00, 0x01, 0x05, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0xff, 0xda, 0x00, 0x0c, 0x03, 0x01, 0x00, 0x02, 0x11, 0x03, 0x11, 0x00, 0x3f, 0x00, 0xd2, 0xcf, 0x20, 0xff, 0xd9]);
+    }
+    getBytes() { return this.data; }
+  }
+
+  const mockStream = new MockStream();
+  const jpegStream = new JpegStream(mockStream, mockStream.data.length, null);
+
+  const canUseImageDecoder = await JpegStream.canUseImageDecoder;
+  const transferableImage = await jpegStream.getTransferableImage();
+
+  if (canUseImageDecoder) {
+    expect(transferableImage).not.toBeNull();
+  } else {
+    expect(transferableImage).toBeNull();
+  }
+});
```

</details>
